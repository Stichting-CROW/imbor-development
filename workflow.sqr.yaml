# yaml-language-server: $schema=https://rdmr.eu/sparql-query-runner/schema.json
version: v5
prefixes:
  rdf: http://www.w3.org/1999/02/22-rdf-syntax-ns#
  owl: http://www.w3.org/2002/07/owl#
  imbor-domeinwaarde: https://data.crow.nl/imbor/id/domeinwaarden/
  imbor: https://data.crow.nl/imbor/def/
  imbor-term: https://data.crow.nl/imbor/term/
  imbor-refmodels: https://data.crow.nl/imbor-ref/def/
  imbor-meta: https://data.crow.nl/imbor/aanvullend-metamodel/
  imbor-refmodels-id: https://data.crow.nl/imbor-ref/id/
  imbor-mim: https://data.crow.nl/imbor/mim/
  quantitykind: http://qudt.org/vocab/quantitykind/
  nen2660: https://w3id.org/nen2660/def#
  nen2660-term: https://w3id.org/nen2660/term#
  nen3610: http://definities.geostandaarden.nl/def/nen3610#
  mim: http://bp4mc2.org/def/mim#
  unit: http://qudt.org/vocab/unit/
  rdfs: http://www.w3.org/2000/01/rdf-schema#
  xsd: http://www.w3.org/2001/XMLSchema#
  dct: http://purl.org/dc/terms/
  dc: http://purl.org/dc/elements/1.1/
  geo: http://www.opengis.net/ont/geosparql#
  sh: http://www.w3.org/ns/shacl#
  skos: http://www.w3.org/2004/02/skos/core#
  dash: http://datashapes.org/dash#
  coll: https://data.crow.nl/rest-api/id#
  restapi: https://data.crow.nl/rest-api/def#
jobs:
  converteer-accessdb:
    steps:
      - shell: npx @rdmr-eu/rdfjs-source-msaccess --input data/IMBOR-2022-03.accdb --output .cache/imbor-latest.nq --mode csv --datatypes easy-sparql

  stap-1-data-opbouw:
    sources:
      - file: .cache/imbor-latest.nq
    steps:
      - update: src/transformations/addendum-geometrie.rq
      - update: src/transformations/attributen.rq
      - update: src/transformations/attribuutshapes.rq
      - update: src/transformations/enumeratietypes-domeinwaarden.rq
      - update: src/transformations/enumeratietypes-gesloten.rq
      - update: src/transformations/enumeratietypes-klasses.rq
      - update: src/transformations/imbor-metaontologie.rq
      - update: src/transformations/informatiemodellen.rq
      - update: src/transformations/klassen-definities.rq
      - update: src/transformations/klassen-hierarchie.rq
      - update: src/transformations/minimale-dataset.rq
      - update: src/transformations/oagbd.rq
      - update: src/transformations/referentiemodel-attributen.rq
      - update: src/transformations/referentiemodel-domeinwaarden.rq
      - update: src/transformations/referentiemodel-mapping.rq
      - update: src/transformations/referentiemodel-mapping-delete.rq
      - update: src/transformations/referentiemodel-mapping-delete-ref.rq
      - update: src/transformations/referentiemodel-mapping-delete-all.rq
      - update: src/transformations/referentiemodel-objecttypen.rq
      - update: src/transformations/semantische-relaties.rq
      - update: src/transformations/termen-en-collecties.rq
      - update: src/transformations/klassen-hierarchie-skos.rq
      - update: src/transformations/unit-quantity-kind.rq
      - update: src/transformations/vakdisciplines.rq
      - update: src/transformations/owl-ontologies.rq
      - update: src/transformations/scheme-skos.rq
    targets:
      - file: .cache/post-stap-1-data-opbouw.nq

  stap-2-hernoemen:
    sources:
      - file: .cache/post-stap-1-data-opbouw.nq
    steps:
      - update: src/transformations/hernoemen-refurls.rq
      - update: src/transformations/hernoemen-refurls.rq
      - update: src/transformations/hernoemen-refurls.rq
      - update: src/transformations/vocab-hierarchie-1.rq
      - update: src/transformations/vocab-hierarchie-2.rq
      - update: src/transformations/vocab-hierarchie-3.rq
    targets:
      - file: .cache/post-stap-2-hernoemen.nq

  stap-3-mim:
    sources:
      - file: .cache/post-stap-2-hernoemen.nq
    steps:
      - update: src/transformations/mim-klasses.rq
      - update: src/transformations/mim-attributen.rq
      - update: src/transformations/mim-relaties.rq
      - update: src/transformations/mim-enumeraties.rq
      - update: src/transformations/mim-domeinwaarden.rq
      - update: src/transformations/mim-datatype.rq
      - update: src/transformations/mim-generalisaties.rq
    targets:
      - file: .cache/post-stap-3-mim.nq

  stap-4-metadata:
    sources:
      - file: .cache/post-stap-3-mim.nq
    steps:
      - update: src/transformations/versie-publicatie-graaf-info.rq
      - update: src/transformations/shacl-messages&rules.rq
      - update: src/transformations/qualifiedValueShape-replace-qualifiedMaxMin-991.rq
      - update: src/transformations/qualifiedValueShape-min-constraint.rq
    targets:
      - file: .cache/stap-4-metadata.nq

  stap-5-outputs-zonder-externe-ontologieen:
    sources:
      - file: .cache/stap-4-metadata.nq
    targets:
      - file: data/imbor-vocabulaire.ttl
        with:
          only-graphs:
            - "https://data.crow.nl/imbor/term/"

      - file: data/imbor-kern.ttl
        with:
          only-graphs:
            - "https://data.crow.nl/imbor/def/"

      - file: data/imbor-domeinwaarden.ttl
        with:
          only-graphs:
            - "https://data.crow.nl/imbor/id/domeinwaarden/"

      - file: data/imbor-aanvullend-metamodel.ttl
        with:
          only-graphs:
            - "https://data.crow.nl/imbor/aanvullend-metamodel"

      - file: data/imbor-informatief.trig
        with:
          only-graphs:
            - "https://data.crow.nl/imbor/addendum/oagbd"
            - "https://data.crow.nl/imbor/addendum/geometrie"
            - "https://data.crow.nl/imbor/addendum/minimale-dataset"
            - "https://data.crow.nl/imbor/addendum/referentiemodellen"
            - "https://data.crow.nl/imbor/mim"

      - file: data/imbor-informatief_LacesUpload.ttl
        with:
          only-graphs:
            - "https://data.crow.nl/imbor/addendum/oagbd"
            - "https://data.crow.nl/imbor/addendum/geometrie"
            - "https://data.crow.nl/imbor/addendum/minimale-dataset"
            - "https://data.crow.nl/imbor/addendum/referentiemodellen"
            - "https://data.crow.nl/imbor/mim"

      - file: data/imbor-rest-api-linkset.ttl
        with:
          only-graphs:
            - "https://data.crow.nl/imbor/addendum/rest-api"

  stap-6-outputs-met-externe-ontologieen:
    sources:
      - file: .cache/stap-4-metadata.nq
    targets:
      - file: data/imbor-volledig-onto-verkenner.ttl
        with:
          only-graphs:
            - https://data.crow.nl/imbor/term/
            - https://data.crow.nl/imbor/def/
            - https://data.crow.nl/imbor/id/domeinwaarden/
            - https://data.crow.nl/imbor/aanvullende-modellen
            - https://data.crow.nl/imbor/aanvullend-metamodel
            - https://data.crow.nl/imbor/addendum/oagbd
            - https://data.crow.nl/imbor/addendum/geometrie
            - https://data.crow.nl/imbor/addendum/minimale-dataset
            - https://data.crow.nl/imbor/addendum/referentiemodellen
            - https://data.crow.nl/imbor/mim

      - file: data/imbor-gecombineerd-tbv-shaclvalidatie.ttl
        with:
          only-graphs:
            - https://data.crow.nl/imbor/def/
            - https://data.crow.nl/imbor/id/domeinwaarden/
            - https://data.crow.nl/imbor/aanvullende-modellen
            - https://data.crow.nl/imbor/aanvullend-metamodel
